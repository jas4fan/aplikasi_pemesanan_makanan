{% extends "driver/base.html" %}
{% block title %}Dashboard | Driver{% endblock %}
{% block content %}

<div class="row">
  <!-- Sidebar: Profil Driver -->
  <div class="col-lg-4 mb-4">
    <!-- Card Profil -->
    <div class="card mb-3">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">ğŸ‘¤ Profil Saya</h5>
      </div>
      <div class="card-body">
        <p class="mb-2">
          <strong>Nama:</strong><br>
          {{ driver.user.get_full_name|default:driver.user.username }}
        </p>
        <p class="mb-2">
          <strong>Phone:</strong><br>
          {{ driver.phone|default:"-" }}
        </p>
        <p class="mb-2">
          <strong>Kendaraan:</strong><br>
          {{ driver.get_vehicle_display }}
        </p>
        <p class="mb-2">
          <strong>Status:</strong><br>
          {% if driver.is_available %}
            <span class="badge bg-success">âœ“ Tersedia</span>
          {% else %}
            <span class="badge bg-warning">âŠ˜ Tidak Tersedia</span>
          {% endif %}
        </p>
        <p class="mb-0">
          <strong>Rating:</strong><br>
          <span class="badge bg-info">â­ {{ driver.rating|default:"0.0" }}</span>
        </p>
      </div>
    </div>

    <!-- Card Unassigned Orders -->
    <div class="card">
      <div class="card-header bg-warning text-dark">
        <h6 class="mb-0">ğŸ“‹ Pesanan Tersedia</h6>
      </div>
      <div class="card-body">
        {% if unassigned_orders %}
          <ul class="list-group list-group-flush">
            {% for o in unassigned_orders %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <div>
                  <strong>#{{ o.id }}</strong><br>
                  <small>{{ o.restaurant.name }}</small>
                </div>
                <a href="{% url 'driver:order_detail' o.id %}" class="btn btn-sm btn-primary">Lihat</a>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted mb-0">ğŸ’¤ Tidak ada pesanan tersedia saat ini.</p>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Main Content: Assigned Orders -->
  <div class="col-lg-8">
    <div class="card">
      <div class="card-header bg-success text-white">
        <h5 class="mb-0">ğŸšš Pesanan Saya</h5>
      </div>
      <div class="card-body">
        {% if assigned_orders %}
          <div class="row">
            {% for o in assigned_orders %}
              <div class="col-md-6 mb-3">
                <div class="card border-left border-primary">
                  <div class="card-body">
                    <h6 class="card-title">#{{ o.id }} - {{ o.restaurant.name }}</h6>
                    <p class="card-text small">
                      <strong>Customer:</strong> {{ o.customer.name|default:"-" }}<br>
                      <strong>Alamat:</strong> {{ o.address_delivery|truncatechars:50 }}<br>
                      <strong>Total:</strong> Rp {{ o.total_price|default:"-" }}<br>
                      <strong>Status:</strong> 
                      {% if o.status == 'pending' %}
                        <span class="badge bg-secondary">â³ Pending</span>
                      {% elif o.status == 'accepted' %}
                        <span class="badge bg-info">âœ“ Diterima</span>
                      {% elif o.status == 'on_delivery' %}
                        <span class="badge bg-warning">ğŸš— Dalam Perjalanan</span>
                      {% elif o.status == 'completed' %}
                        <span class="badge bg-success">âœ“âœ“ Selesai</span>
                      {% else %}
                        <span class="badge bg-danger">âœ— {{ o.get_status_display }}</span>
                      {% endif %}
                    </p>
                    <div class="btn-group btn-group-sm" role="group">
                      <a href="{% url 'driver:order_detail' o.id %}" class="btn btn-outline-primary">Detail</a>
                      {% if o.status == 'accepted' %}
                        <form method="post" action="{% url 'driver:start_delivery' o.id %}" style="display:inline;">
                          {% csrf_token %}
                          <button type="submit" class="btn btn-outline-warning btn-sm">Mulai Antar</button>
                        </form>
                      {% elif o.status == 'on_delivery' %}
                        <form method="post" action="{% url 'driver:complete_order' o.id %}" style="display:inline;">
                          {% csrf_token %}
                          <button type="submit" class="btn btn-outline-success btn-sm">Selesaikan</button>
                        </form>
                      {% endif %}
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="alert alert-info mb-0">
            ğŸ“­ Belum ada pesanan yang ditugaskan. Tunggu admin atau periksa pesanan tersedia di sidebar!
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

{% endblock %}
